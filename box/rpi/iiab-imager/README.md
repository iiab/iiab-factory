## Automating the management of IIAB images
#### Overall Workflow
1. The generic/secure-accounts.sh script is used to secure an image, remove any root paswords, user keys, and add the IIAB developer keys.
1. rpi/min-sd shrinks the image on a SD card, and specifies optional part of filename -- the IIAB, version, date, git hash are standard.
1. rpi/cp-sd copies the SD card to an image file, and zips it.
1. The ```./upload.py``` program accepts the file name of a zipped image (generated by 1-3 above), uploads to http://archive.org, and updates the rpi-imager's json file.
1. rpi/iiab-imager/upload.py calculates the checksums and sizes that are required for the rpi-imager.json menu description. It also queries for name and description which are displayed it its menu.
1. "rpi/iiab-imager/upload.py -h" shows help.
```
./upload.py -h
usage: upload.py [-h] [-c] [-d DELETE] [-e] [-l] [-s] [-r] [image_name]

Upload image to archive.org, Modify rpi-imager json files.

positional arguments:
  image_name            Specify the image file name

optional arguments:
  -h, --help            show this help message and exit
  -c, --check           Check archive.org version and metadata (no changes).
  -d DELETE, --delete DELETE
                        Delete listed item by number.
  -e, --experimental    Put image into Experimental menu.
  -l, --list            List menus.
  -s, --save            Save current menus
  -r, --restore         Restore saved menus
```
6. The "--list" outputs image name and a number which can be used to delete an old menu item from the json file.
6. The '--save" and "--restore" options add some safety for "delete" and "add" functions.
6. "rpi/iiab-imager/upload.py <image filename.zip>" uploads the image to archive.org, sets the metadata at archive.org, and adds the image metadata and url to the json files that specify the "Released" and "Experimental" sub menus.
1. The "Released" menu is the default target for a new image. The "Experimental" menu is targeted by using the "-e" flag.
1. The rpi/iiab-imager/toplevel.py refreshes the top level menu items from Raspberry Pi Foundation site, and adds the IIAB **Released** and **Experimental** menu items. The ```toplevel.py``` should be run after the release of a new vesion of raspbian (on average every 2-3 months).
